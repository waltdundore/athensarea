
# AthensArea.net

This is an autogenerated structure for deploying a collaborative static content platform using Docker, Vagrant, Ansible, and Directus.

---

## 🔧 Setup

```bash
make setup
```

- Initializes git submodules
- Installs pre-commit secret scanning hook
- Sets executable permissions on project scripts

---

## 🐳 Local Development with Docker

```bash
make docker-up
```

- Builds and starts all services in `docker-compose.yml`

To stop services:

```bash
make docker-down
```

---

## 🖥️ Development with Vagrant + Docker

```bash
make vagrant-up
```

- Brings up a Debian 12 VM
- Installs Docker, Compose, and other prerequisites
- Automatically runs `docker-compose up` inside the VM

To halt or destroy the VM:

```bash
make vagrant-halt
make vagrant-destroy
```

---

## 🚀 Deploy to Server (with Ansible)

```bash
make deploy
```

Runs the Ansible playbook using encrypted secrets.

---

## 🔐 Vault Commands

```bash
make vault-check     # Checks encryption
make vault-encrypt   # Encrypts secrets
make vault-decrypt   # Decrypts secrets
```

---

## 🔄 Updating Submodule Content

The `public/` directory is managed as a Git submodule that points to [`athensarea-content`](https://github.com/waltdundore/athensarea-content).

To pull the latest updates from its default branch:

```bash
make update-public
```

This command:
- Automatically detects the default branch (`main`, `master`, or `production`)
- Pulls the latest changes from the remote submodule repo
- Ensures the content is fresh before deployment

---

## 🧪 Testing & Linting

```bash
make test       # Run preflight checks
make lint       # Run Ansible/YAML linting
```

---

## 🔄 Publishing Workflow

```bash
make publish
```

- Validates vault encryption
- Runs secret scan
- Prompts for commit message and pushes

---

## 🧰 Misc

```bash
make clean             # Clean logs, retries, Vagrant, cache
make directus-setup    # Bootstrap Directus admin environment
```

---

## 🛡️ Vault Password Management

The vault password is stored in `.vault_pass.txt` (default: `password`). To keep it secure:

```bash
chmod 600 .vault_pass.txt
```

Ensure this file is in `.gitignore`.

---

## 🪪 License

This project is licensed under the GNU General Public License v3.0. See the [LICENSE](LICENSE) file for full details.
