# AthensArea.net

This is an autogenerated structure for deploying a collaborative static content platform using Docker, Vagrant, Ansible, and Directus.

---

## 🔧 Setup

```bash
make setup
```

- Initializes git submodules
- Installs pre-commit secret scanning hook
- Sets executable permissions on project scripts

---

## 🐳 Local Development with Docker

```bash
make docker-deploy
```

- Builds and starts all services in `docker-compose.yml`

To stop services:

```bash
docker compose down
```

---

## 🖥️ Development with Vagrant + Docker

```bash
make vm-up         # Starts the VM
make dev-up        # Runs docker compose up inside the VM
make dev-upd       # Rebuilds and runs containers inside the VM
```

To connect or destroy:

```bash
make vm-ssh        # SSH into the VM
make vm-reset      # Halt, destroy, and clean the VM
```

---

## 🚀 Deployment

```bash
make deploy
```

- Detects if Vagrant is running and uses VM-based deployment
- Falls back to Docker Compose deployment if outside VM

---

## 🔐 Vault Commands

```bash
make vault-check     # Checks if secrets are encrypted
make vault-encrypt   # Encrypts secrets
make vault-decrypt   # Decrypts secrets
```

Vault password is stored in `.vault_pass.txt` and should be:

```bash
chmod 600 .vault_pass.txt
```

Ensure it's listed in `.gitignore`.

---

## 🔄 Updating Public Submodule

The `public/` directory is managed as a Git submodule that points to [`athensarea-content`](https://github.com/waltdundore/athensarea-content).

To pull latest content:

```bash
make update-public
```

This will:

- Detect the default submodule branch
- Pull the latest updates
- Ensure up-to-date static content

---

## 🧪 Testing & Linting

```bash
make test     # Preflight/syntax checks
make lint     # YAML + Ansible linting
```

---

## 🔄 Publishing Workflow

```bash
make publish
```

- Validates and auto-encrypts vault
- Scans for secrets before committing
- Prompts for commit message and pushes to remote

---

## 🧰 Misc

```bash
make clean          # Remove logs, retry, vagrant cache
make logs           # Stream docker logs inside the VM
make directus-setup # Start only Directus container
```

---

## 🪪 License

This project is licensed under the GNU General Public License v3.0. See the LICENSE file for full details.

